<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promina-Drnis Aplikacija</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#0066cc">
    <!-- iOS podr≈°ka -->
    <link rel="apple-touch-icon" href="icons/grbPD_bez_natpisa_pozadina.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script>
        // URL va≈°e web aplikacije
        const TARGET_URL = 'https://promina-drnis-app.vercel.app/login';
        
        // Funkcija za preusmjeravanje
        function redirectToApp() {
            window.location.href = TARGET_URL;
        }

        // Provjera je li aplikacija otvorena kao instalirana PWA
        function isPWA() {
            // Provjera je li aplikacija pokrenuta kao standalone (PWA s poƒçetnog zaslona)
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone || // za iOS
                   document.referrer.includes('android-app://');
        }
        
        // Provjera za prikaz bannera instalacije
        function showInstallPrompt() {
            // Detekcija mobilnog ureƒëaja
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            // Provjera je li veƒá instalirano kao PWA
            if (isMobile && !isPWA()) {
                // Detektiraj browser
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                const isAndroid = /Android/.test(navigator.userAgent);
                
                if (isIOS) {
                    document.getElementById('ios-banner').style.display = 'block';
                } else if (isAndroid) {
                    document.getElementById('android-banner').style.display = 'block';
                }
            }
        }
        
        // Uƒçitavanje
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const autoRedirect = urlParams.get('autoredirect');
            const noRedirect = urlParams.get('noredirect');
            
            // Prika≈æi banner za instalaciju ako je potrebno
            setTimeout(showInstallPrompt, 1500); // Malo odgodimo da korisnik prvo vidi sadr≈æaj stranice
            
            // Ako je aplikacija pokrenuta kao PWA, odmah preusmjeri - ALI samo ako je PWA
            if (isPWA() && noRedirect !== 'true') {
                redirectToApp();
                return;
            }
            
            // Auto-preusmjeravanje samo ako je eksplicitno zatra≈æeno parametrom
            if (autoRedirect === 'true' && noRedirect !== 'true') {
                const countdownElement = document.getElementById('countdown');
                let seconds = 5;
                
                const countdownInterval = setInterval(function() {
                    countdownElement.textContent = seconds;
                    seconds--;
                    
                    if (seconds < 0) {
                        clearInterval(countdownInterval);
                        redirectToApp();
                    }
                }, 1000);
                
                document.getElementById('countdown-container').style.display = 'block';
            }
        };
        
        function closeBanner(id) {
            document.getElementById(id).style.display = 'none';
        }
    </script>
</head>
<body>
    <!-- Banner za iOS ureƒëaje -->
    <div id="ios-banner" class="install-banner">
        <div class="banner-content">
            <span class="banner-close" onclick="closeBanner('ios-banner')">&times;</span>
            <strong>Dodajte na poƒçetni zaslon:</strong>
            <ol>
                <li>Kliknite <span class="icon-text">‚Üë</span> (Dijeli) na dnu ekrana</li>
                <li>Odaberite "Dodaj na poƒçetni zaslon"</li>
                <li>Kliknite "Dodaj" u gornjem desnom kutu</li>
            </ol>
        </div>
    </div>
    
    <!-- Banner za Android ureƒëaje -->
    <div id="android-banner" class="install-banner">
        <div class="banner-content">
            <span class="banner-close" onclick="closeBanner('android-banner')">&times;</span>
            <strong>Dodajte na poƒçetni zaslon:</strong>
            <ol>
                <li>Kliknite <span class="icon-text">‚ãÆ</span> (izbornik) gore desno</li>
                <li>Odaberite "Dodaj na poƒçetni zaslon"</li>
                <li>Kliknite "Dodaj" na prozoru koji se pojavi</li>
            </ol>
        </div>
    </div>

    <div class="container">
        <img src="icons/grbPD_bez_natpisa_pozadina.png" alt="Promina-Drnis Logo" class="logo">
        <h1>PD Promina Drni≈°</h1>
        <p>Dobrodo≈°li u PD Mobilnu aplikaciju!</p>
        
        <div class="info-text">
            <p>Ova aplikacija slu≈æi kao poveznica na glavnu web aplikaciju Promina-Drnis.</p>
            <p>Ako je ovo va≈° prvi posjet, pogledajte informacije ispod:</p>
        </div>
        
        <div class="card highlight-card">
            <h2>üì± Dodajte na poƒçetni zaslon!</h2>
            <p>Za lak≈°i pristup kasnije, dodajte ovu aplikaciju na poƒçetni zaslon va≈°eg mobitela:</p>
            <ul>
                <li><strong>Android (Chrome):</strong> Izbornik (tri toƒçke ‚ãÆ) ‚Üí "Dodaj na poƒçetni zaslon"</li>
                <li><strong>iPhone (Safari):</strong> Dijeljenje (strelica gore ‚Üë) ‚Üí "Dodaj na poƒçetni zaslon"</li>
            </ul>
        </div>
        
        <div class="card">
            <h2>Kako koristiti aplikaciju?</h2>
            <ol>
                <li>Kliknite na gumb "Pristupi aplikaciji" ispod</li>
                <li>Prijavi se sa svojim korisniƒçkim podacima</li>
                <li>U≈æivaj u svim moguƒánostima Promina-Drnis sustava</li>
            </ol>
        </div>
        
        <div id="countdown-container" style="display: none;">
            <p>Automatsko preusmjeravanje za <span id="countdown">5</span> sekundi...</p>
        </div>
        
        <button onclick="redirectToApp()" class="primary-button">Pristupi aplikaciji</button>
    </div>

    <script>
        // Registracija service workera za PWA funkcionalnost
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registriran uspje≈°no:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registracija nije uspjela:', error);
                    });
            });
        }
    </script>
</body>
</html>
